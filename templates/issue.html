<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Émettre un diplôme</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0;
            padding: 0;
        }
        header {
            background: #2c3e50;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        header h1 {
            margin: 0;
            font-size: 1.5em;
        }
        nav {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        nav a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        nav a:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .auth-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .auth-button:hover {
            background: #45a049;
        }
        .logout-button {
            background: #e53935;
        }
        .logout-button:hover {
            background: #c62828;
        }
        .content {
            max-width: 800px;
            margin: 30px auto;
            padding: 0 20px;
        }
        label { display:block; margin-top:10px; }
        input, button { width:100%; padding:10px; margin-top:5px; box-sizing: border-box; }
        button { background:#4CAF50; color:white; border:none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #45a049; }
        .revoke-btn { background:#e53935; }
        .revoke-btn:hover { background:#c62828; }
        pre { background:#eee; padding:10px; white-space:pre-wrap; border-radius: 4px; }
        hr { margin:30px 0; }
    </style>
</head>
<body>

<script>
const token = localStorage.getItem("token");
if (!token) window.location.href = "login.html";

const payload = JSON.parse(atob(token.split(".")[1]));
if (payload.role !== "school") {
    alert("Access denied");
    window.location.href = "index.html";
}
</script>

<header>
    <h1>Plateforme d'attestation de diplômes</h1>
    <div style="display: flex; align-items: center; gap: 20px;">
        <nav id="mainNav">
            <a href="index.html">Accueil</a>
            <a href="verify.html">Vérifier</a>
            <a href="issue.html">Émettre</a>
            <a href="all_diplomas.html">Tous les diplômes</a>
        </nav>
        <button class="auth-button logout-button" onclick="logout()">Déconnexion</button>
    </div>
</header>

<div class="content">

<script>
function logout() {
  localStorage.removeItem("token");
  window.location.href = "index.html";
}
</script>


<h2>Émettre un diplôme</h2>

<form id="issueForm">
    <label>Nom de l'étudiant (username)</label>
    <input type="text" id="student_name" required>

    <label>Email de l'étudiant</label>
    <input type="email" id="student_email" required>

    <label>Nom du diplôme</label>
    <input type="text" id="degree_name" required>

    <button type="submit">Émettre</button>
</form>
<p style="color: #666; font-size: 0.9em; margin-top: 10px;">ℹ️ Un mot de passe sera généré automatiquement et envoyé par email</p>

<h3>Résultat :</h3>
<pre id="issueResult">Aucun.</pre>

<hr>

<h2>Révoquer un diplôme</h2>

<form id="revokeForm">
    <label>ID du diplôme à révoquer</label>
    <input type="text" id="diploma_id" required>

    <button type="submit" class="revoke-btn">Révoquer</button>
</form>

<pre id="revokeResult">Aucun.</pre>

</div>

<script>
document.getElementById("issueForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const payload = {
        student_name: student_name.value,
        student_email: student_email.value,
        degree_name: degree_name.value
    };
    const res = await fetch("/issue", {
    method: "POST",
    headers: {
        "Content-Type":"application/json",
        "Authorization": token
    },
    body: JSON.stringify(payload)
    });
    const json = await res.json();
    issueResult.textContent = JSON.stringify(json, null, 2);
});

document.getElementById("revokeForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const payload = { id: diploma_id.value };
    const res = await fetch("/revoke", {
    method: "POST",
    headers: {
        "Content-Type":"application/json",
        "Authorization": token
    },
    body: JSON.stringify(payload)
    });
    const json = await res.json();
    revokeResult.textContent = JSON.stringify(json, null, 2);
});
</script>

</body>
</html>
